<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

    <!-- files start -->
    <script src="vue/dist/vue.js"></script>
    <script src="axios/dist/axios.min.js"></script>
    <script src="js-cookie-master/src/js.cookie.js"></script>
    <script type="text/javascript" src="Semantic-UI-CSS-master/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="Semantic-UI-CSS-master/semantic.css">
    <script type="text/javascript" src="Semantic-UI-CSS-master/semantic.min.js"></script>
    <script type="text/javascript" src="moment.js"></script>
    <script type="text/javascript" src="auth.js">
    </script>
    <link rel="styesheet" type="text/css" href="custom_button.css">
    <script type="text/javascript" src="purl-master/purl.js"></script>
    <!-- files stop -->
    <style>
        @font-face {
        font-family:'MON3 Anonta 1';
        src:local('MON3 Anonta 1'),url('http://mmwebfonts.comquas.com/fonts/mon3.ttf');
        }
        body,html,p,code,*,table,td,tr,span,div,a,ul,li,input,textarea{font-family:'MON3 Anonta 1'!important;}
        .title-info {
            background-color: aquamarine;
            color: white;
        }
        
        #bubble-info {
            margin-left: 30px;
            margin-top: 30px;
            position: absolute;
        }
        
        table {
            transition-property: all;
            transition-duration: 0.5s;
        }
        
        table:hover {
            transform: scale(1.1, 1.1);
        }
        
        refresh-btn {}
        
        circle:hover {
            stroke-width: 1px;
            stroke: black;
            opacity: 1;
        }
        
        circle {
            cursor: pointer;
            opacity: 0.8;
        }
        
        text {
            z-index: 0;
            cursor: default;
            user-select: none;
        }
        #refresh-btn{
            margin-top: 30px;
            margin-left: 90%;
        },
        body {}
    </style>
    <script src="d3.v4.min.js"></script>
</head>

<body>
   
    <div id="bubble-info">

        <table style="width:220px" class="ui celled striped table green">
            <thead>
                <tr>
                    <th colspan="2">

                        <center><div id="tit">.....</div></center>

                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="post">
                        <!--          201 Total discusstions -->.....
                    </td>
                </tr>
                <tr>
                    <td id="discuss">
                        <!--      87 people are interested in this-->....</td>
                </tr>
            </tbody>
        </table>
        <script>
        </script>
        
    </div>
                <button  id="refresh-btn" class="ui green button" onclick="refresh()">Refresh</button>
    <div class="chart-example" id="chart">
        <svg></svg>
    </div>

    <script>
        var colors = [
"rgb(253,91,3)",
"rgb(123,176,166)",
"rgb(80,48,90)",
"rgb(0,221,207)",
"rgb(37,55,61)",
"rgb(61,142,185)",
"rgb(227,0,14)",
"rgb(96,100,109)",
"rgb(238,84,58)",
"rgb(149,49,99)",
"rgb(136,136,136)",
"rgb(44,130,201)",
"rgb(136,112,255)",
"rgb(150,132,163)",
"rgb(136,112,255)",
"rgb(126,54,97)",
"rgb(187,54,88)",
 "rgb(60,55,65)",
"rgb(138,45,60)",
"rgb(137,127,186)",
"rgb(172,164,111)",
"rgb(0,88,122)",
"rgb(15,48,87)",
"rgb(255,126,85)",
"rgb(22,160,133)",
"rgb(121,148,18)",
"rgb(204,145,148)",
"rgb(80,56,30)"
        ]
        var nodes = [
            {
                index: 0,
                tag: "ကျန်းမာရေး",
                post: 10,
                discuss: 26,
                total: 36
                    }, {
                index: 1,
                tag: "GGရေး",
                post: 50,
                discuss: 26,
                total: 76
                    },
            {
                index: 2,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 80
                    },
            {
                index: 3,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 31
                    },
            {
                index: 4,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 46
                    },
            {
                index: 5,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 76
                    },
            {
                index: 6,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 71
                    },
            {
                index: 7,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 73
                    },
            {
                index: 8,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 44
                    },
            {
                index: 8,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 66
                    },
            {
                index: 9,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 78
                    },
            {
                index: 10,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 140
                    },
            {
                index: 11,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    },
            {
                index: 12,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 13,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 14,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 15,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 16,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 17,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 18,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 19,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 20,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }
,
            {
                index: 21,
                tag: "ZZရေး",
                post: 50,
                discuss: 26,
                total: 100
                    }


            ]

        function getNodeColor(node) {
            return colors[node.index];
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getNodeText(node) {
            return node.tag;
        }

        var maxValue = nodes.reduce(function (a, b) {
            return Math.max.apply(Math, nodes.map(function (o) {
                return o.total;
            }))
        });

        var minValue = nodes.reduce(function (a, b) {
            return Math.min.apply(Math, nodes.map(function (o) {
                return o.total;
            }))
        });

        var linearScale = d3.scaleLinear()
            .domain([minValue, maxValue])
            .range([30, 100]);
        //        console.log(linearScale('100'));
        function getRadious(node) {
            return linearScale(node.total);
        }

        var width = window.innerWidth;
        var height = window.innerHeight;


        var svg = d3.select('svg')
        svg.attr('width', width).attr('height', height);

        var simulation = d3
            .forceSimulation()
            .force('charge', d3.forceManyBody().strength(-500))
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force("x", d3.forceX(0))
            .force("y", d3.forceY(0))

        var dragDrop = d3.drag().on('start', function (node) {
            node.fx = node.x
            node.fy = node.y
        }).on('drag', function (node) {
            simulation.alphaTarget(0.7).restart()
            node.fx = d3.event.x
            node.fy = d3.event.y
            console.log(node.tag);
            $("table").css("transform", "scale(1.09,1.09)");
            $("#post").text((node.post+15)+ " total discussions");
            $("#discuss").text((node.discuss+10)+ " people are intereted in this");
            $("#tit").text(node.tag);
        }).on('end', function (node) {
            if (!d3.event.active) {
                simulation.alphaTarget(0)
                console.log("end");
                $("table").css("transform", "scale(1.0,1.0)");
                $("#tit").text("..........");
                $("#post").text("..........");
                $("#discuss").text("..........");
            }
            node.fx = null
            node.fy = null
        })

        function selectNode(node) {
            console.log("node is start");
        }


        var nodeElements = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("r", getRadious)
            .attr("fill", getNodeColor)
            .call(dragDrop)
            .on('click', selectNode)


        var textElements = svg.append("g")
            .attr("class", "texts")
            .attr("fill", 'white')
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("font-size", 14)
            .attr("dx", 0)
            .attr("text-anchor", "middle")
            .attr("dy", 4).text(getNodeText);

        simulation.nodes(nodes).on('tick', () => {
            nodeElements
                .attr('cx', function (node) {
                    return node.x
                })
                .attr('cy', function (node) {
                    return node.y
                })
            textElements
                .attr('x', function (node) {
                    return node.x
                })
                .attr('y', function (node) {
                    return node.y
                })

        })
    </script>

    <script>
        refresh();

        function refresh() {
            axios.get('http://askbox.host.com:9999/tag/used')
                .then(
                    response => {
                        console.log(response.data.data);
                        $("svg").empty();
                        nodes = response.data.name;


                        var maxValue = nodes.reduce(function (a, b) {
                            return Math.max.apply(Math, nodes.map(function (o) {
                                return o.total;
                            }))
                        });

                        var minValue = nodes.reduce(function (a, b) {
                            return Math.min.apply(Math, nodes.map(function (o) {
                                return o.total;
                            }))
                        });
                        var width = window.innerWidth;
                        var height = window.innerHeight;


                        var svg = d3.select('svg')
                        svg.attr('width', width).attr('height', height);

                        var simulation = d3
                            .forceSimulation()
                            .force('charge', d3.forceManyBody().strength(-500))
                            .force('center', d3.forceCenter(width / 2, height / 2))
                            .force("x", d3.forceX(0))
                            .force("y", d3.forceY(0))

                        var dragDrop = d3.drag().on('start', function (node) {
                            node.fx = node.x
                            node.fy = node.y
                            $("table").css("transform", "scale(1.09,1.09)");
                            $("#post").text(node.post+15 + " total discussions");
                            $("#discuss").text(node.answer+10+ " people are intereted in this");
                            $("#tit").text(node.tag);
                        }).on('drag', function (node) {
                            simulation.alphaTarget(0.7).restart()
                            node.fx = d3.event.x
                            node.fy = d3.event.y
                            console.log(node.tag);
                        }).on('end', function (node) {
                            if (!d3.event.active) {
                                simulation.alphaTarget(0)
                                $("table").css("transform", "scale(1.0,1.0)");
                                $("#tit").text("..........");
                                $("#post").text("..........");
                                $("#discuss").text("..........");
                            }
                            node.fx = null
                            node.fy = null
                        })

                        function selectNode(node) {
                            console.log("node is start");
                        }
                        var linearScale = d3.scaleLinear()
                            .domain([minValue, maxValue])
                            .range([30, 100]);
                        //        console.log(linearScale('100'));
                        function getRadious(node) {
                            console.log(node.total);
                            return linearScale(node.total);
                            

                        }


                        var nodeElements = svg.append("g")
                            .attr("class", "nodes")
                            .selectAll("circle")
                            .data(nodes)
                            .enter().append("circle")
                            .attr("r", getRadious)
                            .attr("fill", getNodeColor)
                            .call(dragDrop)
                            .on('click', selectNode)


                        var textElements = svg.append("g")
                            .attr("class", "texts")
                            .attr("fill", 'white')
                            .selectAll("text")
                            .data(nodes)
                            .enter().append("text")
                            .attr("font-size", 14)
                            .attr("dx", 0)
                            .attr("text-anchor", "middle")
                            .attr("dy", 4).text(getNodeText);

                        simulation.nodes(nodes).on('tick', () => {
                            nodeElements
                                .attr('cx', function (node) {
                                    return node.x
                                })
                                .attr('cy', function (node) {
                                    return node.y
                                })
                            textElements
                                .attr('x', function (node) {
                                    return node.x
                                })
                                .attr('y', function (node) {
                                    return node.y
                                })

                        })

                        console.log(nodes);
                    }).catch(e => {
                    console.log("ERROR");
                })

        }
    </script>
</body>

</html>